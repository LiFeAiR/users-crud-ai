# Архитектурные решения: Безопасное хранение паролей

## Контекст

В системе необходимо обеспечить безопасное хранение паролей пользователей в базе данных, чтобы предотвратить утечку конфиденциальной информации в случае взлома базы данных.

## Решение

Для безопасного хранения паролей будет использоваться алгоритм bcrypt с высоким уровнем стоимости (work factor).

### Преимущества bcrypt:
- Специально разработан для хеширования паролей
- Автоматическая генерация уникальной соли для каждого пароля
- Высокая стоимость вычислений делает атаки перебора затруднительными
- Широко используется в сообществе разработчиков

## Реализация

### 1. Хеширование паролей
При регистрации пользователя:
1. Получаем пароль от пользователя
2. Хешируем его с помощью bcrypt с параметром `bcrypt.DefaultCost`
3. Сохраняем только хеш в базе данных
4. Оригинальный пароль не сохраняется ни в какой форме

### 2. Проверка паролей
При аутентификации пользователя:
1. Получаем введенный пользователем пароль
2. Получаем хеш из базы данных для данного пользователя
3. Сравниваем пароль с хешем с помощью `bcrypt.CompareHashAndPassword`
4. Если совпадают - аутентификация успешна

### 3. Структура данных
В модели пользователя (`internal/models/user.go`) поле пароля должно хранить только хеш, а не оригинальный пароль.

### 4. Обновление компонентов
- `internal/utils/password.go` - содержит функции для хеширования и проверки паролей
- `internal/repository/user_repository.go` - обновлены методы для работы с хешами
- `internal/handlers/...` - обновлены обработчики для использования безопасного механизма

## Безопасность на всех уровнях

1. **На уровне приложения**:
    - Использование только безопасных алгоритмов хеширования
    - Защита от атак перебора (rate limiting)
    - Логирование попыток входа

2. **На уровне базы данных**:
    - Хранение только хешей паролей
    - Не использовать поля для хранения оригинальных паролей
    - Регулярные проверки целостности данных

3. **На уровне сети**:
    - Все передачи должны быть зашифрованы (HTTPS/TLS)
    - Пароли не должны передаваться в открытом виде

## Требования к реализации

1. Все пароли должны хешироваться перед сохранением в БД
2. Никогда не хранить оригинальные пароли
3. Использовать только bcrypt для хеширования
4. Обеспечить backward compatibility при необходимости
5. Написать тесты для проверки безопасности хеширования

## Альтернативные решения

### SHA-256 + соль
- Недостатки: не достаточно безопасен для хранения паролей
- Не учитывает скорость вычислений
- Подвержен атакам перебора

### MD5/SHA-1
- Недостатки: устаревшие алгоритмы, легко взламываются
- Не подходят для хранения паролей

## Заключение

Реализация bcrypt обеспечивает высокий уровень безопасности для хранения паролей и соответствует современным стандартам криптографической защиты.

После создания файла вы сможете использовать его как архитектурный документ по безопасному хранению паролей в вашем проекте.